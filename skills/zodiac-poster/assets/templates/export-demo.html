<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=1080, height=1440">
    <title>海报导出演示 - 射手座</title>

    <!-- 字体 -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;500;600;700&family=Noto+Sans+SC:wght@300;400;500&display=swap" rel="stylesheet">

    <!-- 必要依赖：html2canvas（DOM→Canvas） -->
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

    <!-- 可选依赖：JSZip + FileSaver（批量导出） -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

    <!-- 海报工具库 -->
    <script src="../js/poster-utils.js"></script>

    <style>
        :root {
            --bg-color: #F5F2ED;
            --text-primary: #3D3835;
            --text-secondary: #6B6461;
            --accent-color: #C4653A;
            --line-color: #D4CFC8;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #E5E5E5;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 40px 20px;
            font-family: 'Noto Sans SC', sans-serif;
        }

        h1 {
            color: var(--text-primary);
            margin-bottom: 20px;
            font-size: 24px;
        }

        .controls {
            display: flex;
            gap: 12px;
            margin-bottom: 30px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: var(--accent-color);
            color: white;
            box-shadow: 0 4px 12px rgba(196, 101, 58, 0.3);
        }

        .btn-primary:hover {
            background: #A85432;
            transform: translateY(-2px);
        }

        .btn-primary:disabled {
            background: #999;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: white;
            color: var(--text-primary);
            border: 1px solid var(--line-color);
        }

        .btn-secondary:hover {
            background: #f5f5f5;
        }

        /* 海报容器 */
        .poster-container {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .poster-wrapper {
            position: relative;
        }

        .poster-label {
            text-align: center;
            margin-top: 10px;
            color: var(--text-secondary);
            font-size: 14px;
        }

        /* 海报样式 */
        .poster {
            width: 1080px;
            height: 1440px;
            background: linear-gradient(165deg, #FAF6F1 0%, #F5EDE4 50%, #F0E6D9 100%);
            position: relative;
            padding: 90px 100px;
            display: flex;
            flex-direction: column;
            font-family: 'Noto Serif SC', serif;
            transform-origin: top left;
            transform: scale(0.3);
            margin-bottom: -1008px; /* 补偿缩放 */
            margin-right: -756px;
        }

        .poster::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(180deg,
                rgba(255,255,255,0.3) 0%,
                rgba(255,255,255,0) 20%,
                rgba(0,0,0,0) 80%,
                rgba(0,0,0,0.03) 100%
            );
            pointer-events: none;
            z-index: 1;
        }

        .poster > * {
            position: relative;
            z-index: 2;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .header-title {
            display: flex;
            align-items: baseline;
            gap: 6px;
        }

        .header-zodiac {
            font-size: 32px;
            font-weight: 500;
            color: var(--accent-color);
            letter-spacing: 2px;
        }

        .header-separator {
            font-family: 'Georgia', serif;
            font-size: 24px;
            color: var(--line-color);
            margin: 0 4px;
        }

        .header-topic {
            font-family: 'Noto Sans SC', sans-serif;
            font-size: 24px;
            font-weight: 300;
            color: var(--text-secondary);
            letter-spacing: 3px;
        }

        .zodiac-symbol svg {
            width: 56px;
            height: 56px;
            stroke: var(--accent-color);
            stroke-width: 1.5;
            fill: none;
            transform: rotate(-10deg);
        }

        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding: 60px 0;
        }

        .headline {
            font-size: 72px;
            font-weight: 700;
            color: var(--text-primary);
            line-height: 1.3;
            letter-spacing: 4px;
            margin-bottom: 40px;
        }

        .headline .highlight {
            color: var(--accent-color);
        }

        .tagline {
            font-size: 28px;
            color: var(--text-secondary);
            letter-spacing: 3px;
            line-height: 1.6;
        }

        .footer {
            margin-top: auto;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
        }

        .footer-line {
            width: 100%;
            height: 2px;
            background: var(--line-color);
            margin-bottom: 24px;
        }

        .page-number {
            font-family: 'Georgia', serif;
            font-size: 28px;
            color: var(--text-secondary);
            letter-spacing: 4px;
        }

        /* 进度条 */
        .progress-container {
            display: none;
            margin-top: 20px;
            width: 300px;
        }

        .progress-bar {
            height: 8px;
            background: #ddd;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--accent-color);
            width: 0%;
            transition: width 0.3s ease;
        }

        .progress-text {
            text-align: center;
            margin-top: 8px;
            color: var(--text-secondary);
            font-size: 14px;
        }
    </style>
</head>
<body>
    <h1>海报导出演示</h1>

    <div class="controls">
        <button class="btn btn-primary" id="exportSingle">导出单张</button>
        <button class="btn btn-primary" id="exportAll">导出全部（ZIP）</button>
        <button class="btn btn-secondary" id="addButton">添加浮动按钮</button>
    </div>

    <div class="progress-container" id="progress">
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>
        <div class="progress-text" id="progressText">准备中...</div>
    </div>

    <div class="poster-container">
        <!-- 封面 -->
        <div class="poster-wrapper">
            <div class="poster" id="poster-cover">
                <div class="header">
                    <div class="header-title">
                        <span class="header-zodiac">射手座</span>
                        <span class="header-separator">·</span>
                        <span class="header-topic">轻计划学习法</span>
                    </div>
                    <div class="zodiac-symbol">
                        <svg viewBox="0 0 24 24">
                            <path d="M4 20L20 4M20 4H10M20 4V14" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </div>
                </div>

                <div class="main-content">
                    <h1 class="headline">
                        学习这件事<br>
                        <span class="highlight">有趣</span>比系统重要
                    </h1>
                    <p class="tagline">
                        射手座的学习方式<br>
                        从来不是按部就班
                    </p>
                </div>

                <div class="footer">
                    <div class="footer-line"></div>
                    <span class="page-number">0 1</span>
                </div>
            </div>
            <div class="poster-label">封面 (01)</div>
        </div>

        <!-- 内页 -->
        <div class="poster-wrapper">
            <div class="poster" id="poster-page2">
                <div class="header">
                    <div class="header-title">
                        <span class="header-zodiac">射手座</span>
                        <span class="header-separator">·</span>
                        <span class="header-topic">轻计划学习法</span>
                    </div>
                    <div class="zodiac-symbol">
                        <svg viewBox="0 0 24 24">
                            <path d="M4 20L20 4M20 4H10M20 4V14" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </div>
                </div>

                <div class="main-content">
                    <h1 class="headline" style="font-size: 56px;">
                        能让我们<span class="highlight">坚持</span>的<br>
                        从来不是计划表
                    </h1>
                    <p class="tagline">
                        是那一刻的"有意思"<br>
                        是好奇心被点燃的感觉
                    </p>
                </div>

                <div class="footer">
                    <div class="footer-line"></div>
                    <span class="page-number">0 2</span>
                </div>
            </div>
            <div class="poster-label">内页 (02)</div>
        </div>
    </div>

    <script>
        // 海报配置
        const posters = [
            { id: 'poster-cover', name: '01_封面' },
            { id: 'poster-page2', name: '02_内页' }
        ];

        // 导出单张
        document.getElementById('exportSingle').addEventListener('click', async function() {
            const btn = this;
            btn.disabled = true;
            btn.textContent = '导出中...';

            try {
                await PosterUtils.exportPoster({
                    element: document.getElementById('poster-cover'),
                    filename: '射手座_轻计划学习法_封面.png',
                    scale: 2
                });
            } catch (error) {
                alert('导出失败: ' + error.message);
            } finally {
                btn.disabled = false;
                btn.textContent = '导出单张';
            }
        });

        // 导出全部（ZIP）
        document.getElementById('exportAll').addEventListener('click', async function() {
            const btn = this;
            const progress = document.getElementById('progress');
            const progressFill = document.getElementById('progressFill');
            const progressText = document.getElementById('progressText');

            btn.disabled = true;
            btn.textContent = '导出中...';
            progress.style.display = 'block';
            progressFill.style.width = '0%';

            try {
                await PosterUtils.downloadPosters(posters, '射手座_轻计划学习法.zip', {
                    onStart: () => {
                        progressText.textContent = '开始导出...';
                    },
                    onProgress: (current, total) => {
                        const percent = Math.round((current / total) * 100);
                        progressFill.style.width = percent + '%';
                        progressText.textContent = `导出中... ${current}/${total}`;
                    },
                    onEnd: () => {
                        progressText.textContent = '导出完成!';
                        setTimeout(() => {
                            progress.style.display = 'none';
                        }, 2000);
                    },
                    onError: (error) => {
                        progressText.textContent = '导出失败: ' + error.message;
                    }
                });
            } catch (error) {
                alert('导出失败: ' + error.message);
            } finally {
                btn.disabled = false;
                btn.textContent = '导出全部（ZIP）';
            }
        });

        // 添加浮动按钮
        document.getElementById('addButton').addEventListener('click', function() {
            PosterUtils.createExportButton({
                text: '快速导出',
                loadingText: '处理中...',
                position: 'bottom-right',
                onClick: async () => {
                    await PosterUtils.exportPoster({
                        element: document.getElementById('poster-cover'),
                        filename: '快速导出.png'
                    });
                }
            });
            this.disabled = true;
            this.textContent = '已添加';
        });
    </script>
</body>
</html>
