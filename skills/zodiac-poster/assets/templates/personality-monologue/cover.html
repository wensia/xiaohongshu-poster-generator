<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>性格独白风 - 封面模板</title>

  <!-- React -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- 导出依赖 -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
  <script src="../../js/poster-utils.js"></script>

  <!-- 字体 -->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;500;600;700&family=Noto+Sans+SC:wght@300;400;500&display=swap" rel="stylesheet">

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      background: #f5f5f5;
      font-family: -apple-system, BlinkMacSystemFont, sans-serif;
    }
    #poster-container {
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      border-radius: 8px;
      overflow: hidden;
    }
    .controls {
      margin-top: 20px;
      display: flex;
      gap: 12px;
    }
    .btn {
      padding: 12px 24px;
      font-size: 16px;
      font-weight: 500;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .btn-primary {
      background: #C4653A;
      color: white;
    }
    .btn-primary:hover {
      background: #A85432;
      transform: translateY(-2px);
    }
    .btn:disabled {
      background: #999;
      cursor: not-allowed;
      transform: none;
    }
  </style>
</head>
<body>
  <div id="poster-container"></div>
  <div class="controls">
    <button id="export-btn" class="btn btn-primary">导出 PNG</button>
  </div>

  <script type="text/babel">
    // ============================================
    // 配色系统（性格独白风）
    // ============================================
    const COLORS = {
      accent: '#C4653A',       // 强调色
      textPrimary: '#3D3835',  // 主文字
      textSecondary: '#6B6461',// 次要文字
      divider: '#D4CFC8',      // 分隔线
      bgStart: '#FAF6F1',      // 渐变起点
      bgMid: '#F5EDE4',        // 渐变中点
      bgEnd: '#F0E6D9'         // 渐变终点
    };

    // ============================================
    // 默认数据（可通过 window.POSTER_DATA 覆盖）
    // ============================================
    const DEFAULT_DATA = {
      zodiac: '射手座',
      zodiacEn: 'SAGITTARIUS',
      topic: '性格独白',
      subtitle: '唯独受不了委屈',
      titleLine1: '什么苦都能吃',
      titleLine2: '却扛不住心寒',
      tagline1: '看起来没心没肺',
      tagline2Text: '其实',
      tagline2Highlight: '心思细腻',
      pageNum: '0 1',
      zodiacSvg: null  // 星座图标 SVG 内容
    };

    // 从 window 读取数据，与默认值合并
    const DATA = { ...DEFAULT_DATA, ...(window.POSTER_DATA || {}) };

    // ============================================
    // 星座图标组件
    // ============================================
    function ZodiacIcon({ zodiac }) {
      // 射手座图标
      const sagittariusIcon = (
        <svg viewBox="0 0 100 100" width="56" height="56" fill="none" stroke={COLORS.accent} strokeWidth="1.5">
          <line x1="20" y1="80" x2="80" y2="20"/>
          <line x1="80" y1="20" x2="55" y2="20"/>
          <line x1="80" y1="20" x2="80" y2="45"/>
          <line x1="25" y1="45" x2="55" y2="75"/>
        </svg>
      );

      // 根据星座返回对应图标（可扩展）
      const icons = {
        '射手座': sagittariusIcon,
        '白羊座': sagittariusIcon,  // TODO: 添加其他星座图标
        '金牛座': sagittariusIcon,
        '双子座': sagittariusIcon,
        '巨蟹座': sagittariusIcon,
        '狮子座': sagittariusIcon,
        '处女座': sagittariusIcon,
        '天秤座': sagittariusIcon,
        '天蝎座': sagittariusIcon,
        '摩羯座': sagittariusIcon,
        '水瓶座': sagittariusIcon,
        '双鱼座': sagittariusIcon,
      };

      return icons[zodiac] || sagittariusIcon;
    }

    // ============================================
    // 封面组件
    // ============================================
    function CoverPage({ data }) {
      return (
        <svg id="poster-svg" width="2160" height="2880" viewBox="0 0 1080 1440" xmlns="http://www.w3.org/2000/svg">
          {/* 背景渐变定义 */}
          <defs>
            <linearGradient id="bgGradient" x1="0%" y1="100%" x2="100%" y2="0%">
              <stop offset="0%" stopColor={COLORS.bgStart}/>
              <stop offset="50%" stopColor={COLORS.bgMid}/>
              <stop offset="100%" stopColor={COLORS.bgEnd}/>
            </linearGradient>
            <linearGradient id="lightOverlay" x1="0%" y1="0%" x2="0%" y2="100%">
              <stop offset="0%" stopColor="#FFF" stopOpacity="0.3"/>
              <stop offset="20%" stopColor="#FFF" stopOpacity="0"/>
              <stop offset="80%" stopColor="#000" stopOpacity="0"/>
              <stop offset="100%" stopColor="#000" stopOpacity="0.03"/>
            </linearGradient>
          </defs>

          {/* 背景 */}
          <rect width="1080" height="1440" fill="url(#bgGradient)"/>
          <rect width="1080" height="1440" fill="url(#lightOverlay)"/>

          {/* 页眉 */}
          <g id="header">
            <text x="100" y="130"
                  fontFamily="Noto Serif SC, serif"
                  fontSize="32"
                  fontWeight="500"
                  fill={COLORS.accent}
                  letterSpacing="2">
              {data.zodiac}
            </text>
            <text x="210" y="130"
                  fontFamily="Georgia, serif"
                  fontSize="24"
                  fill={COLORS.divider}>
              ·
            </text>
            <text x="240" y="130"
                  fontFamily="Noto Sans SC, sans-serif"
                  fontSize="24"
                  fontWeight="300"
                  fill={COLORS.textSecondary}
                  letterSpacing="3">
              {data.topic}
            </text>
            <g transform="translate(924, 74) rotate(-10)">
              <ZodiacIcon zodiac={data.zodiac} />
            </g>
          </g>

          {/* 封面内容 */}
          <g id="cover-content">
            {/* 副标题 */}
            <text x="540" y="520"
                  fontFamily="Noto Serif SC, serif"
                  fontSize="32"
                  fill={COLORS.textSecondary}
                  textAnchor="middle"
                  letterSpacing="6">
              {data.subtitle}
            </text>

            {/* 主标题第一行 */}
            <text x="540" y="660"
                  fontFamily="Noto Serif SC, serif"
                  fontSize="72"
                  fontWeight="600"
                  fill={COLORS.textPrimary}
                  textAnchor="middle"
                  letterSpacing="6">
              {data.titleLine1}
            </text>

            {/* 主标题第二行（高亮） */}
            <text x="540" y="750"
                  fontFamily="Noto Serif SC, serif"
                  fontSize="72"
                  fontWeight="600"
                  fill={COLORS.accent}
                  textAnchor="middle"
                  letterSpacing="6">
              {data.titleLine2}
            </text>

            {/* 分隔线 */}
            <rect x="490" y="830" width="100" height="4" fill={COLORS.accent}/>

            {/* 标语第一行 */}
            <text x="540" y="920"
                  fontFamily="Noto Serif SC, serif"
                  fontSize="30"
                  fill={COLORS.textSecondary}
                  textAnchor="middle"
                  letterSpacing="4">
              {data.tagline1}
            </text>

            {/* 标语第二行（带高亮） */}
            <text x="540" y="980"
                  fontFamily="Noto Serif SC, serif"
                  fontSize="30"
                  textAnchor="middle"
                  letterSpacing="4">
              <tspan fill={COLORS.textSecondary}>{data.tagline2Text}</tspan>
              <tspan fill={COLORS.accent}>{data.tagline2Highlight}</tspan>
            </text>
          </g>

          {/* 页脚 */}
          <g id="footer">
            <line x1="100" y1="1350" x2="980" y2="1350"
                  stroke={COLORS.divider}
                  strokeWidth="2"/>
            <text x="980" y="1390"
                  fontFamily="Georgia, serif"
                  fontSize="28"
                  fill={COLORS.textSecondary}
                  textAnchor="end"
                  letterSpacing="4">
              {data.pageNum}
            </text>
          </g>
        </svg>
      );
    }

    // ============================================
    // 渲染
    // ============================================
    ReactDOM.render(
      <CoverPage data={DATA} />,
      document.getElementById('poster-container')
    );

    // ============================================
    // 导出功能
    // ============================================
    document.getElementById('export-btn').addEventListener('click', async function() {
      const btn = this;
      const originalText = btn.textContent;

      btn.disabled = true;
      btn.textContent = '导出中...';

      try {
        const filename = `${DATA.zodiac}_${DATA.topic}_封面.png`;
        await window.PosterUtils.exportPoster({
          element: document.getElementById('poster-svg'),
          filename: filename,
          scale: 2,
          mode: 'svg'
        });
      } catch (error) {
        alert('导出失败: ' + error.message);
        console.error(error);
      } finally {
        btn.disabled = false;
        btn.textContent = originalText;
      }
    });
  </script>
</body>
</html>
