---
name: fetching-viral-notes
description: Fetches viral Xiaohongshu notes with low followers but high engagement using MCP and saves them to Feishu Bitable. Use when the user wants to search for specific keywords, filter high-engagement low-follower content, collect competitor content, or batch scrape trending notes.
---

## ⚠️ 上下文优化指南（重要）

为避免上下文溢出，执行时必须遵循：

1. **限制抓取数量**：默认最多处理 5 条笔记，用户可指定更多
2. **精简输出**：处理过程中不要输出完整的笔记内容和作者信息
3. **只提取必要字段**：从 API 返回中只提取需要保存的字段，忽略其他数据
4. **批量汇报**：处理完成后一次性汇报结果，格式如下：

```
✅ 抓取完成！
- 搜索关键词：xxx
- 搜索结果：X 条
- 符合条件：Y 条（粉丝<10000 且 点赞>1000）
- 已保存：Y 条

| 标题 | 点赞 | 粉丝 | 互动比 |
|------|------|------|--------|
| xxx  | 5000 | 2000 | 2.5    |
```

5. **遇到 Context low 提示**：立即停止抓取，汇报已完成的结果

---

# 小红书低粉爆文抓取器

搜索小红书内容，筛选低粉高互动的爆文，保存到飞书多维表格进行分析。

---

## 首次使用 - 初始化多维表格

**如果是首次使用，需要先初始化飞书多维表格的字段：**

```bash
cd "/Users/panyuhang/我的项目/编程/脚本/小红书封面生成"
python skills/fetch-viral-notes/init_bitable_fields.py
```

这会在"低粉爆文抓取"表中创建所需的字段。

---

## 执行前检查

### 1. 检查小红书 MCP 登录状态

> 详细登录流程见 [`skills/_shared/xiaohongshu-login.md`](../_shared/xiaohongshu-login.md)

```
调用 mcp__xiaohongshu-mcp__check_login_status
```

如果未登录，执行扫码登录。

### 2. 飞书配置

> 详细配置见 [`skills/_shared/feishu-config.md`](../_shared/feishu-config.md)

```
app_token: Qt6Qbzzy6aWBgassGQhcUU5vngc
table_id: tblsfs6oJAbTfgaK  # 低粉爆文抓取
```

---

## 核心功能

### 功能 1: 搜索小红书内容

```
调用 mcp__xiaohongshu-mcp__search_feeds
参数:
- keyword: "搜索关键词"
- filters: {
    "sort_by": "最多点赞",      # 综合|最新|最多点赞|最多评论|最多收藏
    "note_type": "不限",        # 不限|视频|图文
    "publish_time": "一周内"    # 不限|一天内|一周内|半年内
  }
```

### 功能 2: 获取笔记详情

```
调用 mcp__xiaohongshu-mcp__get_feed_detail
参数:
- feed_id: "笔记ID"
- xsec_token: "从搜索结果获取"
```

返回数据包含：
- 标题、内容
- 点赞数、收藏数、评论数
- 作者信息

### 功能 3: 获取作者信息

```
调用 mcp__xiaohongshu-mcp__user_profile
参数:
- user_id: "作者ID"
- xsec_token: "从笔记详情获取"
```

返回数据包含：
- 粉丝数
- 笔记数
- 获赞与收藏总数

### 功能 4: 保存到飞书多维表格

```
调用 mcp__lark-mcp__bitable_v1_appTableRecord_create
参数:
- path: {
    app_token: "Qt6Qbzzy6aWBgassGQhcUU5vngc",
    table_id: "tblsfs6oJAbTfgaK"
  }
- data: {
    fields: {
      "笔记ID": "xxx",
      "标题": "xxx",
      "内容摘要": "xxx",
      "作者昵称": "xxx",
      "作者粉丝数": 1234,
      "点赞数": 5000,
      "收藏数": 3000,
      "评论数": 200,
      "搜索关键词": "xxx",
      "笔记链接": "https://www.xiaohongshu.com/explore/xxx"
    }
  }
```

---

## 低粉爆文筛选标准

**低粉爆文定义：粉丝少但互动高的笔记**

建议筛选条件：
| 指标 | 条件 | 说明 |
|------|------|------|
| 作者粉丝数 | < 10000 | 低粉账号 |
| 点赞数 | > 1000 | 有一定热度 |
| 互动粉丝比 | > 0.1 | 互动数/粉丝数 > 10% |

**互动粉丝比计算公式：**
```
互动粉丝比 = (点赞数 + 收藏数 + 评论数) / 作者粉丝数
```

比值越高，说明内容质量越好，值得参考。

---

## 飞书多维表格字段

| 序号 | 字段名 | 类型 | 说明 |
|------|--------|------|------|
| 1 | 笔记ID | 文本 | 小红书笔记唯一标识 |
| 2 | 标题 | 文本 | 笔记标题 |
| 3 | 内容摘要 | 文本 | 正文前200字 |
| 4 | 作者昵称 | 文本 | 作者名称 |
| 5 | 作者ID | 文本 | 作者唯一标识 |
| 6 | 作者粉丝数 | 数字 | 抓取时的粉丝数 |
| 7 | 点赞数 | 数字 | 笔记点赞数 |
| 8 | 收藏数 | 数字 | 笔记收藏数 |
| 9 | 评论数 | 数字 | 笔记评论数 |
| 10 | 互动粉丝比 | 数字 | 计算值，互动总数/粉丝数 |
| 11 | 笔记类型 | 单选 | 图文/视频 |
| 12 | 笔记链接 | 文本 | 小红书链接 |
| 13 | 封面图 | 文本 | 封面图URL |
| 14 | 搜索关键词 | 文本 | 抓取时使用的关键词 |
| 15 | 抓取时间 | 日期 | 数据抓取时间 |
| 16 | 已分析 | 复选框 | 是否已分析 |
| 17 | 备注 | 文本 | 人工备注 |

---

## 完整抓取流程（精简版）

```
用户: 帮我抓取"星座运势"相关的低粉爆文

Claude 执行（注意：全程保持精简输出）:

1. 检查登录 → 只输出"已登录"或"未登录"

2. 搜索内容 → 只记录搜索到 N 条结果

3. 处理笔记（默认最多5条）:
   - 静默获取详情和作者信息
   - 只提取: 标题、点赞、收藏、评论、粉丝数
   - 静默保存到飞书
   - 不要输出每条笔记的完整内容！

4. 最终汇报（一次性输出表格）
```

**关键优化点：**
- 搜索结果只记录数量，不输出列表
- 处理过程不输出中间结果
- 只在最后输出汇总表格

---

## 使用示例

### 示例 1: 按关键词抓取

```
用户: 抓取"穿搭"相关的低粉爆文，要求点赞过千

Claude:
1. 搜索"穿搭"关键词
2. 筛选点赞 > 1000 且粉丝 < 10000 的笔记
3. 保存到飞书表格
```

### 示例 2: 批量抓取多个关键词

```
用户: 抓取这些关键词的爆文：护肤、美妆、穿搭

Claude:
1. 依次搜索每个关键词
2. 筛选符合条件的笔记
3. 批量保存到飞书
4. 标记搜索关键词字段
```

### 示例 3: 指定筛选条件

```
用户: 抓取"旅行"爆文，粉丝5000以下，点赞5000以上

Claude:
1. 搜索"旅行"
2. 筛选粉丝 < 5000 且点赞 > 5000
3. 保存符合条件的笔记
```

---

## 注意事项

1. **避免频繁抓取**：建议每次抓取间隔 2-3 秒，避免被限流
2. **去重处理**：保存前检查笔记ID是否已存在
3. **数据时效性**：互动数据会变化，记录抓取时间
4. **登录状态**：cookies 有效期约 7 天，过期需重新登录

---

## 错误处理

### 小红书未登录

```
症状：check_login_status 返回未登录
解决：运行登录工具扫码登录
```

### 获取详情失败

```
症状：get_feed_detail 返回错误
可能原因：
- xsec_token 过期
- 笔记已删除
- 请求过于频繁
解决：跳过该笔记，继续处理下一条
```

### 飞书写入失败

```
症状：record_create 返回错误
可能原因：
- 字段类型不匹配
- 必填字段缺失
解决：检查字段配置，运行 init_bitable_fields.py
```
